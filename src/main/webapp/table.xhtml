<?xml version="1.0" encoding="UTF-8"?>
<ui:composition template="template.xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets">
    <ui:define name="head">
        <h:outputScript name="js/jquery.js"/>
        <script type="text/javascript">
            //<![CDATA[

            $(document).ready(function() {
                #{game.init(player.name, "Super C")}

                if (#{game.round} > 0) {
                    $("#player1").appendTo(document.getElementById("#{game.getRoadName(game.player.getPositionMinusT(1))}"));
                    $("#player2").appendTo(document.getElementById("#{game.getRoadName(game.computer.getPositionMinusT(1))}"));
                    drawPlayer1NoOil();
                }

                return false;
            });

            function drawPlayer1NoOil() {
                //Animation Player 1
                $("#player1").fadeOut(700, function() {
                    $("#player1").appendTo(document.getElementById("#{game.getRoadName(game.player.position)}"));
                    $("#player1").fadeIn(700, drawPlayer1Oil);
                });
            }

            function drawPlayer1Oil() {
                if (#{game.isOilField(game.player.position)}) {
                    //Zuruecksetzen auf den Start des Players 1

                    $("#player1").fadeOut(700, function() {
                        $("#player1").appendTo(document.getElementById("start_road"));
                        $("#player1").fadeIn(700, drawPlayer2NoOil);
                    });
                } else {
                    drawPlayer2NoOil();
                }
            }

            function drawPlayer2NoOil() {

                if (#{game.computer.score} != 0) {
                    //Animation Player 2
                    $("#player2").fadeOut(700, function() {
                        $("#player2").appendTo(document.getElementById("#{game.getRoadName(game.computer.position)}"));
                        $("#player2").fadeIn(700, drawPlayer2Oil);
                    });
                } else {
                    completeAnimation;
                }
            }

            function drawPlayer2Oil() {
                if (#{game.isOilField(game.computer.position)}) {
                    //Zuruecksetzen auf den Start des Players 2

                    $("#player2").fadeOut(700, function() {
                        $("#player2").appendTo(document.getElementById("start_road"));
                        $("#player2").fadeIn(700, completeAnimation);
                    });
                } else {
                    completeAnimation();
                }
            }

            // call this function once after all animations have finished
            function completeAnimation() {
                var div = $(document.createElement('div'));
                div.attr('id', 'animationDone');
                div.addClass('hide');
                $("body").append(div);
            }
            //]]>
        </script>
    </ui:define>
    <ui:define name="navigation">
        <ul title="Navigation">
            <li><h:link outcome="table.xhtml" value="#{msg.newgame}" /></li>
            <li><h:link outcome="login.xhtml" value="#{msg.logout}" /></li>
        </ul>
    </ui:define>
    <ui:define id="info" name="info">
        <h:panelGroup layout="block" id="info" class="info">
            <h2>#{msg.gameInfo}</h2>
            <table summary="Diese Tabelle zeigt Informationen zum aktuellen Spiel">
                <tr><th id="leaderLabel" class="label">#{msg.leader}</th><td id="leader" class="data">#{game.leader.name != null ? game.leader.name : msg.multiple}</td></tr>
                <tr><th id="roundLabel" class="label">#{msg.round}</th><td id="round" class="data">#{game.round}</td></tr>
                <tr><th id="timeLabel" class="label">#{msg.time}</th><td id="time" class="data">#{game.spentTimeString}</td></tr>
                <tr><th id="computerScoreLabel" class="label">#{msg.roll} <em>#{game.computer.name}</em></th><td id="computerScore" class="data">#{game.computer.score}</td></tr>
            </table>  
            <h2>#{msg.player}</h2>
            <table summary="Diese Tabelle listet die Namen der Spieler auf">
                <tr><th id="player1NameLabel" class="label">#{msg.player} 1</th><td id="player1Name" class="data">#{game.player.name}</td></tr>
                <tr><th id="player2NameLabel" class="label">#{msg.player} 2</th><td id="player2Name" class="data">#{game.computer.name}</td></tr>
            </table>    	
        </h:panelGroup>
    </ui:define>

    <ui:define name="field">
        <h:panelGroup layout="block" id="field" class="field">
            <h2 class="accessibility">#{msg.track}</h2>
            <ol id="road">
                <li id="start_road">
                    <span class="accessibility">#{msg.start}</span>
                </li>
                <li class="empty_road" id="road_1">
                    <span class="accessibility">#{msg.field} 2</span>
                    <span id="player1">
                        <span class="accessibility"><em>#{msg.player} 1</em></span>
                    </span>
                    <span id="player2">
                        <span class="accessibility"><em>#{msg.player} 2</em></span>
                    </span>
                </li>
                <li class="oil_road" id="road_2">
                    <span class="accessibility">#{msg.field} 3</span>
                </li>
                <li class="empty_road" id="road_3">
                    <span class="accessibility">#{msg.field} 4</span>
                </li>
                <li class="empty_road" id="road_4">
                    <span class="accessibility">#{msg.field} 5</span>
                </li>
                <li class="oil_road" id="road_5">
                    <span class="accessibility">#{msg.field} 6</span>
                </li>
                <li id="finish_road">
                    <span class="accessibility">#{msg.finish}</span>
                </li>
            </ol>
        </h:panelGroup>
    </ui:define>

    <ui:define name="player">
        <h:panelGroup layout="block" id="player" class="player">
            <h2 class="accessibility">#{msg.diceArea}</h2>
            <span class="accessibility">#{msg.turn}</span><div id="currentPlayerName">#{game.player.name}</div>
            <h:form id="form">
                <h:commandButton id="dice" image="resources/img/wuerfel#{game.getDiceEyes()}.png" tabindex="4" action="#{game.rollthedice}" title="#{msg.diceDesc} #{game.getDiceEyesString()}" alt="#{msg.diceDesc} #{game.getDiceEyesString()}">
                    <f:ajax render=":info :field :player"/>
                </h:commandButton>
            </h:form>
            <h:outputText id="out" value="p1 sc:#{game.player.score}, pos: #{game.player.position}, cp sc:#{game.computer.score}, pos: #{game.computer.position}, go: #{game.gameOver}"/> 
        </h:panelGroup>
    </ui:define>
</ui:composition>
